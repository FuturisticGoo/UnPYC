"""
A script to get the version of by which the file was compiled
"""

import struct


MAGICS = {
    20121: '1.5.x',
    50428: '1.6',
    50823: '2.0.x',
    60202: '2.1.x',
    60717: '2.2',
    62011: '2.3a0',
    62021: '2.3a0',
    62041: '2.4a0',
    62051: '2.4a3',
    62061: '2.4b1',
    62071: '2.5a0',
    62081: '2.5a0',
    62091: '2.5a0',
    62092: '2.5a0',
    62101: '2.5b3',
    62111: '2.5b3',
    62121: '2.5c1',
    62131: '2.5c2',
    62151: '2.6a0',
    62161: '2.6a1',
    62171: '2.7a0',
    62181: '2.7a0',
    62191: '2.7a0',
    62201: '2.7a0',
    62211: '2.7a0',
    3000: '3000',
    3010: '3000',
    3020: '3000',
    3030: '3000',
    3040: '3000',
    3050: '3000',
    3060: '3000',
    3061: '3000',
    3071: '3000',
    3081: '3000',
    3091: '3000',
    3101: '3000',
    3103: '3000',
    3111: '3.0a4',
    3131: '3.0b1',
    3141: '3.1a1',
    3151: '3.1a1',
    3160: '3.2a1',
    3170: '3.2a2',
    3180: '3.2a3',
    3190: '3.3a1',
    3200: '3.3a1',
    3210: '3.3a1',
    3220: '3.3a2',
    3230: '3.3a4',
    3250: '3.4a1',
    3260: '3.4a1',
    3270: '3.4a1',
    3280: '3.4a1',
    3290: '3.4a4',
    3300: '3.4a4',
    3310: '3.4rc2',
    3320: '3.5a1',
    3330: '3.5b1',
    3340: '3.5b2',
    3350: '3.5b3',
    3351: '3.5.2',
    3360: '3.6a0',
    3361: '3.6a1',
    3370: '3.6a2',
    3371: '3.6a2',
    3372: '3.6a2',
    3373: '3.6b1',
    3375: '3.6b1',
    3376: '3.6b1',
    3377: '3.6b1',
    3378: '3.6b2',
    3379: '3.6rc1',
    3390: '3.7a1',
    3391: '3.7a2',
    3392: '3.7a4',
    3393: '3.7b1',
    3394: '3.7b5',
    3400: '3.8a1',
    3401: '3.8a1',
    3410: '3.8a1',
    3411: '3.8b2',
    3412: '3.8b2',
    3413: '3.8b4',
    3420: '3.9a0',
    3421: '3.9a0',
    3422: '3.9a0',
    3423: '3.9a2',
    3424: '3.9a2',
    3425: '3.9a2',
    3430: '3.10a1',
}


def get_magic(filename):
    """Get the version of by which the file was compiled."""
    try:
        with open(filename, 'rb') as in_file:
            magic = in_file.read(4)
            magic_data = struct.unpack('H2B', magic)
            python_version = MAGICS.get(magic_data[0], '')
            if magic_data[1:] != (13, 10):
                return "Error:1"
            if not python_version:
                return "Error:2"
    except Exception as f:
        if(type(f) == struct.error):
            return "Error:3"
        return "Error:4"

    return python_version
